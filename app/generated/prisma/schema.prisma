// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ---------------------------------------------------------------------------
// Enums
// ---------------------------------------------------------------------------

enum UserRole {
  counselor
  coordinator
  student
}

enum GradeLevel {
  ninth
  tenth
  eleventh
  twelfth
}

enum CurriculumType {
  CBSE
  ICSE
  IB
  CAIE
  State_Board
  US_High_School
  Other
}

enum GradingSystemType {
  Marks_Out_Of_100
  Percentage
  IB_Scale
  Letter_Grade
  Other
}

enum Semester {
  Fall
  Spring
  Full_Year
}

enum HonorsLevel {
  Standard
  Honors
  AP
  IB_HL
  IB_SL
}

enum AchievementType {
  Award_Honor
  Competition
  Leadership
  Social_Impact
  Extracurricular
}

enum RecognitionLevel {
  School
  Inter_School
  District
  City
  State
  National
  International
}

enum ExperienceType {
  Academic_Project
  Independent_Project
  Research
  Internship
  Summer_Program
  Work_Experience
}

enum ProjectStatus {
  Completed
  In_Progress
  Planned
}

// ---------------------------------------------------------------------------
// Models
// ---------------------------------------------------------------------------

model Organization {
  id            String   @id @default(uuid())
  name          String
  logo_url      String?
  primary_color String   @default("#3B82F6")
  created_at    DateTime @default(now())

  users User[]
}

model User {
  id              String   @id @default(uuid())
  organization_id String
  email           String   @unique
  password_hash   String
  role            UserRole
  first_name      String
  last_name       String
  created_at      DateTime @default(now())

  organization         Organization @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  student              Student?
  coordinated_students Student[]    @relation("PrimaryCoordinator")
  meeting_logs         MeetingLog[] @relation("CoordinatorMeetings")
}

model Student {
  user_id                String     @id
  graduation_year        Int
  current_grade          GradeLevel
  primary_coordinator_id String?
  profile_completion_pct Int        @default(0)

  user                User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  primary_coordinator User?               @relation("PrimaryCoordinator", fields: [primary_coordinator_id], references: [id], onDelete: SetNull)
  personal_profile    PersonalProfile?
  academic_profile    AcademicProfile?
  transcripts         Transcript[]
  activities          Activity[]
  test_scores         TestScore[]
  achievements        Achievement[]
  project_experiences ProjectExperience[]
  meeting_logs        MeetingLog[]
}

model PersonalProfile {
  student_id      String    @id
  preferred_name  String?
  date_of_birth   DateTime?
  phone           String?
  current_school  String?
  school_location String?
  parent_name     String?
  parent_email    String?
  parent_phone    String?
  created_at      DateTime  @default(now())

  student Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model AcademicProfile {
  student_id          String            @id
  curriculum_type     CurriculumType
  grading_system_type GradingSystemType
  current_gpa         String?
  created_at          DateTime          @default(now())

  student Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Transcript {
  id            String      @id @default(uuid())
  student_id    String
  course_name   String
  grade_level   GradeLevel
  semester      Semester
  grade_value   String
  credits       Float?
  honors_level  HonorsLevel @default(Standard)
  is_board_exam Boolean     @default(false)
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt

  student Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Activity {
  id             String   @id @default(uuid())
  student_id     String
  activity_name  String
  category       String
  role           String?
  grade_levels   Json // array of grade levels
  hours_per_week Int
  weeks_per_year Int
  description    String?
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  student Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model TestScore {
  id              String   @id @default(uuid())
  student_id      String
  test_type       String
  test_name       String
  test_date       DateTime
  composite_score Int?
  section_scores  Json?
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  student Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Achievement {
  id                String            @id @default(uuid())
  student_id        String
  achievement_type  AchievementType
  title             String
  organization      String?
  grade_level       GradeLevel?
  date_achieved     DateTime?
  description       String?
  metrics           String?
  recognition_level RecognitionLevel?
  verifiable_link   String?
  created_at        DateTime          @default(now())
  updated_at        DateTime          @updatedAt

  student Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model ProjectExperience {
  id              String         @id @default(uuid())
  student_id      String
  experience_type ExperienceType
  title           String
  organization    String?
  location        String?
  start_date      DateTime
  end_date        DateTime?
  is_ongoing      Boolean        @default(false)
  role_title      String?
  description     String?
  outcomes        String?
  skills_learned  Json?
  project_link    String?
  mentor_name     String?
  mentor_email    String?
  status          ProjectStatus  @default(Completed)
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt

  student Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model MeetingLog {
  id               String   @id @default(uuid())
  student_id       String
  coordinator_id   String
  meeting_date     DateTime
  duration_minutes Int
  notes            String
  action_items     String?
  created_at       DateTime @default(now())

  student     Student @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
  coordinator User    @relation("CoordinatorMeetings", fields: [coordinator_id], references: [id], onDelete: Cascade)
}

model Subject {
  id              String          @id @default(uuid())
  curriculum_type CurriculumType?
  subject_name    String
  is_default      Boolean         @default(false)

  @@unique([subject_name, curriculum_type])
}

model ActivityCategory {
  id            String  @id @default(uuid())
  category_name String  @unique
  is_default    Boolean @default(false)
}

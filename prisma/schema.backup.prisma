generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AcademicProfile {
  student_id          String            @id
  curriculum_type     CurriculumType
  grading_system_type GradingSystemType
  current_gpa         String?
  created_at          DateTime          @default(now())
  Student             Student           @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Achievement {
  id                String            @id
  student_id        String
  achievement_type  AchievementType
  title             String
  organization      String?
  grade_level       GradeLevel?
  date_achieved     DateTime?
  description       String?
  metrics           String?
  recognition_level RecognitionLevel?
  verifiable_link   String?
  created_at        DateTime          @default(now())
  updated_at        DateTime
  Student           Student           @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Activity {
  id             String   @id
  student_id     String
  activity_name  String
  category       String
  role           String?
  grade_levels   Json
  hours_per_week Int
  weeks_per_year Int
  description    String?
  created_at     DateTime @default(now())
  updated_at     DateTime
  Student        Student  @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model ChangeLog {
  id          String       @id
  student_id  String
  change_type ChangeType
  entity_type String
  entity_id   String?
  action      ChangeAction
  field_name  String?
  old_value   String?
  new_value   String?
  description String
  created_at  DateTime     @default(now())
  Student     Student      @relation(fields: [student_id], references: [user_id], onDelete: Cascade)

  @@index([created_at])
  @@index([student_id])
}

model College {
  id                 String               @id
  name               String
  country            String               @default("United States")
  acceptance_rate    Float?
  avg_gpa            Float?
  avg_sat            Int?
  avg_act            Int?
  ranking_us_news    Int?
  is_active          Boolean              @default(true)
  created_at         DateTime             @default(now())
  updated_at         DateTime
  CollegeApplication CollegeApplication[]
  TargetCollege      TargetCollege[]

  @@index([country])
  @@index([ranking_us_news])
}

model CollegeApplication {
  id                      String    @id(map: "college_applications_pkey")
  student_id              String
  college_id              String
  target_category         String
  application_status      String    @default("Not_Started")
  application_deadline    DateTime?
  decision_deadline       DateTime?
  essay_status            String    @default("Not Started")
  supplements_status      String    @default("Not Started")
  recommendation_status   String    @default("Not Requested")
  test_scores_sent        Boolean   @default(false)
  application_portal_link String?
  notes                   String?
  decision_received_date  DateTime?
  created_at              DateTime  @default(now())
  updated_at              DateTime
  College                 College   @relation(fields: [college_id], references: [id], onDelete: Cascade)
  Student                 Student   @relation(fields: [student_id], references: [user_id], onDelete: Cascade)

  @@index([application_status])
  @@index([college_id])
  @@index([student_id])
  @@index([application_deadline], map: "college_applications_application_deadline_idx")
  @@index([college_id], map: "college_applications_college_id_idx")
  @@index([student_id], map: "college_applications_student_id_idx")
}

model Meeting {
  id                String      @id
  student_id        String
  coordinator_id    String
  meeting_date      DateTime
  duration_minutes  Int?
  meeting_type      MeetingType @default(Regular)
  topics_discussed  String[]
  notes             String?
  action_items      String[]
  next_meeting_date DateTime?
  student_mood      String?
  created_at        DateTime    @default(now())
  updated_at        DateTime
  User              User        @relation(fields: [coordinator_id], references: [id], onDelete: Cascade)
  Student           Student     @relation(fields: [student_id], references: [user_id], onDelete: Cascade)

  @@index([coordinator_id])
  @@index([meeting_date])
  @@index([student_id])
}

model MeetingLog {
  id               String   @id
  student_id       String
  coordinator_id   String
  meeting_date     DateTime
  duration_minutes Int
  notes            String
  action_items     String?
  created_at       DateTime @default(now())
  User             User     @relation(fields: [coordinator_id], references: [id], onDelete: Cascade)
  Student          Student  @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Organization {
  id            String   @id
  name          String
  logo_url      String?
  primary_color String   @default("#3B82F6")
  created_at    DateTime @default(now())
  User          User[]
}

model PersonalProfile {
  student_id      String    @id
  preferred_name  String?
  date_of_birth   DateTime?
  phone           String?
  current_school  String?
  school_location String?
  parent_name     String?
  parent_email    String?
  parent_phone    String?
  created_at      DateTime  @default(now())
  Student         Student   @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model ProfileComment {
  id           String   @id
  student_id   String
  author_id    String
  comment_text String
  section      String?
  is_private   Boolean  @default(false)
  created_at   DateTime @default(now())
  updated_at   DateTime
  User         User     @relation(fields: [author_id], references: [id], onDelete: Cascade)
  Student      Student  @relation(fields: [student_id], references: [user_id], onDelete: Cascade)

  @@index([author_id])
  @@index([student_id])
}

model ProfileGoal {
  id            String     @id
  student_id    String
  goal_type     GoalType
  category      String
  target_value  String
  current_value String?
  deadline      DateTime?
  status        GoalStatus @default(Not_Started)
  priority      Int        @default(5)
  notes         String?
  created_at    DateTime   @default(now())
  updated_at    DateTime
  completed_at  DateTime?
  Student       Student    @relation(fields: [student_id], references: [user_id], onDelete: Cascade)

  @@index([status])
  @@index([student_id])
}

model ProfileOverride {
  id              String   @id
  student_id      String   @unique
  override_score  Int
  override_reason String
  overridden_by   String
  created_at      DateTime @default(now())
  updated_at      DateTime
  User            User     @relation(fields: [overridden_by], references: [id], onDelete: NoAction)
  Student         Student  @relation(fields: [student_id], references: [user_id], onDelete: Cascade)

  @@index([overridden_by])
  @@index([student_id])
}

model ProjectExperience {
  id              String         @id
  student_id      String
  experience_type ExperienceType
  title           String
  organization    String?
  location        String?
  start_date      DateTime
  end_date        DateTime?
  is_ongoing      Boolean        @default(false)
  role_title      String?
  description     String?
  outcomes        String?
  skills_learned  Json?
  project_link    String?
  mentor_name     String?
  mentor_email    String?
  status          ProjectStatus  @default(Completed)
  created_at      DateTime       @default(now())
  updated_at      DateTime
  Student         Student        @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Student {
  user_id                                   String               @id
  graduation_year                           Int
  current_grade                             GradeLevel
  primary_coordinator_id                    String?
  profile_completion_pct                    Int                  @default(0)
  coordinator_id                            String?
  AcademicProfile                           AcademicProfile?
  Achievement                               Achievement[]
  Activity                                  Activity[]
  ChangeLog                                 ChangeLog[]
  CollegeApplication                        CollegeApplication[]
  Meeting                                   Meeting[]
  MeetingLog                                MeetingLog[]
  PersonalProfile                           PersonalProfile?
  ProfileComment                            ProfileComment[]
  ProfileGoal                               ProfileGoal[]
  ProfileOverride                           ProfileOverride?
  ProjectExperience                         ProjectExperience[]
  User_Student_coordinator_idToUser         User?                @relation("Student_coordinator_idToUser", fields: [coordinator_id], references: [id])
  User_Student_primary_coordinator_idToUser User?                @relation("Student_primary_coordinator_idToUser", fields: [primary_coordinator_id], references: [id])
  User_Student_user_idToUser                User                 @relation("Student_user_idToUser", fields: [user_id], references: [id], onDelete: Cascade)
  TargetCollege                             TargetCollege[]
  TestScore                                 TestScore[]
  Transcript                                Transcript[]
}

model Subject {
  id              String          @id
  curriculum_type CurriculumType?
  subject_name    String
  is_default      Boolean         @default(false)

  @@unique([subject_name, curriculum_type])
}

model TargetCollege {
  id         String            @id
  student_id String
  college_id String
  category   TargetCategory
  priority   Int               @default(5)
  status     ApplicationStatus @default(Planning)
  notes      String?
  created_at DateTime          @default(now())
  updated_at DateTime
  College    College           @relation(fields: [college_id], references: [id], onDelete: Cascade)
  Student    Student           @relation(fields: [student_id], references: [user_id], onDelete: Cascade)

  @@unique([student_id, college_id])
  @@index([college_id])
  @@index([student_id])
}

model TestScore {
  id              String   @id
  student_id      String
  test_type       String
  test_name       String
  test_date       DateTime
  composite_score Int?
  section_scores  Json?
  created_at      DateTime @default(now())
  updated_at      DateTime
  Student         Student  @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model Transcript {
  id            String      @id
  student_id    String
  course_name   String
  grade_level   GradeLevel
  semester      Semester
  grade_value   String
  credits       Float?
  honors_level  HonorsLevel @default(Standard)
  is_board_exam Boolean     @default(false)
  created_at    DateTime    @default(now())
  updated_at    DateTime
  Student       Student     @relation(fields: [student_id], references: [user_id], onDelete: Cascade)
}

model User {
  id                                           String            @id
  organization_id                              String
  email                                        String            @unique
  password_hash                                String
  role                                         UserRole
  first_name                                   String
  last_name                                    String
  created_at                                   DateTime          @default(now())
  Meeting                                      Meeting[]
  MeetingLog                                   MeetingLog[]
  ProfileComment                               ProfileComment[]
  ProfileOverride                              ProfileOverride[]
  Student_Student_coordinator_idToUser         Student[]         @relation("Student_coordinator_idToUser")
  Student_Student_primary_coordinator_idToUser Student[]         @relation("Student_primary_coordinator_idToUser")
  Student_Student_user_idToUser                Student?          @relation("Student_user_idToUser")
  Organization                                 Organization      @relation(fields: [organization_id], references: [id], onDelete: Cascade)
}

enum AchievementType {
  Award_Honor
  Competition
  Leadership
  Social_Impact
  Extracurricular
}

enum ActivityCategory {
  Academic
  Arts_Music
  Athletics
  Community_Service
  Cultural
  Leadership
  Other
}

enum ApplicationStatus {
  Planning
  Researching
  Preparing
  In_Progress
  Submitted
  Accepted
  Rejected
  Waitlisted
  Deferred
  Withdrawn
  Not_Started
}

enum ChangeAction {
  Created
  Updated
  Deleted
  Completed
}

enum ChangeType {
  Profile_Update
  Goal_Progress
  New_Addition
  Improvement
  Milestone
}

enum CurriculumType {
  CBSE
  ICSE
  IB
  CAIE
  State_Board
  US_High_School
  Other
}

enum ExperienceType {
  Academic_Project
  Independent_Project
  Research
  Internship
  Summer_Program
  Work_Experience
}

enum GoalStatus {
  Not_Started
  In_Progress
  Completed
  Deferred
  Cancelled
}

enum GoalType {
  Academic
  Testing
  Activity
  Achievement
  Project
  Other
}

enum GradeLevel {
  ninth
  tenth
  eleventh
  twelfth
}

enum GradingSystemType {
  Marks_Out_Of_100
  Percentage
  IB_Scale
  Letter_Grade
  Other
}

enum HonorsLevel {
  Standard
  Honors
  AP
  IB_HL
  IB_SL
}

enum MeetingType {
  Initial
  Regular
  Check_In
  Goal_Review
  Application_Review
  Crisis
  Final
}

enum ProjectStatus {
  Completed
  In_Progress
  Planned
}

enum RecognitionLevel {
  School
  Inter_School
  District
  City
  State
  National
  International
}

enum Semester {
  Fall
  Spring
  Full_Year
}

enum TargetCategory {
  Reach
  Match
  Safety
}

enum UserRole {
  counselor
  coordinator
  student
}
